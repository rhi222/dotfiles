---
name: nippo-add
description: 日報に追記する
disable-model-invocation: true
argument-hint: "<追記内容> (例: start:PRレビュー, end:PRレビュー, フォーカス:横断)"
---

# 日報に追記する

現在の日報ファイル（ ~/Obsidian/02_Daily/nippo.$(date +%Y-%m-%d).md）に以下の内容を追記してください。

## 追記する内容: $ARGUMENTS

まず、日報ファイルが存在するか確認し、存在しない場合は新規作成してください。

### 新規作成の場合

`template.md` サポートファイルのテンプレートを使用して日報を作成してください。

### 目標逆算タスク提案のロジック（新規ファイル作成時）

新規日報ファイルを作成するとき、以下のロジックで「今日のおすすめタスク」を提案してください:

1. **nippo-goals.md を読み込む**
   - パス: `~/Obsidian/02_Daily/nippo-goals.md`

2. **データソース**:
   - **達成基準**: 4軸の `- [ ]` チェックボックスから未完了のものを抽出
   - **行動習慣**: 「毎日（5分）どれか1つ」のリストからランダム/ローテーション
   - **直近の日報**（任意）: 過去数日の日報を読み、手薄な軸を優先

3. **提案ルール**:
   - 1〜2個のタスクを提案（多すぎると逆効果）
   - 各タスクは「5〜15分で着手可能」な粒度に分解
   - 達成基準のチェックボックスと紐づけて表示（例: `[横断] サブシステム構成図のドラフト作成 → 達成基準: サブシステム構成図と責任範囲を整理`）
   - 行動習慣からも1つ提案（例: `[習慣] データ構造を少し見る（5分）`）

### 既存ファイルへの追記の場合

追記内容の先頭キーワードによって自動振り分け：

**時系列ログ（デフォルト）:**

1. 「## 作業ログ（分報・思考メモ）」セクションを探す
2. 最後に以下を追記:

```markdown
- $(date +%H:%M) $ARGUMENTS
```

**特別な処理:**

- `$ARGUMENTS` が「フォーカス:」で始まる → 今日のフォーカスセクションを更新

**時間管理用の処理:**

- `$ARGUMENTS` が「start:」で始まる → 作業開始を記録
  1. 作業ログから未終了の `🟢 start:` を検索
  2. 未終了タスクがあれば警告を表示:
     ```
     ⚠️ 「{タスク名}」が未終了です（{開始時刻}開始）
     先に `/nippo-add end: {タスク名}` するか、このまま続行しますか？
     ```
  3. 続行する場合、作業ログに追記:
     ```markdown
     - $(date +%H:%M) 🟢 start: {タスク名}
     ```

- `$ARGUMENTS` が「end:」で始まる → 作業終了を記録
  1. 作業ログから対応する `🟢 start: {タスク名}` を検索
  2. 開始時刻と現在時刻から経過時間を計算
  3. 作業ログに追記:
     ```markdown
     - $(date +%H:%M) 🔴 end: {タスク名} ({経過時間}分)
     ```
  4. 対応する開始が見つからない場合:
     ```
     ⚠️ 「{タスク名}」の開始記録が見つかりません。時刻なしで記録します。
     ```
     そして追記:
     ```markdown
     - $(date +%H:%M) 🔴 end: {タスク名}
     ```
