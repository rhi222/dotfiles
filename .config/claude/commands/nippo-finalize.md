---
title: "Nippo Finalize"
description: "日報を完成させる"
---

# 日報完成化コマンド

> 日々の作業記録を分析し、目標に対する進捗を可視化した構造化レポートを自動生成するコマンド

## 概要

本日の日報ドラフトファイルと目標ファイル（nippo-goals.md）を分析し、4軸評価に基づいた振り返りレポートを自動生成して日報に追記します。

## 入力・出力

| 項目     | パス                                             | 説明                           |
| -------- | ------------------------------------------------ | ------------------------------ |
| **入力** | `~/Obsidian/02_Daily/nippo.YYYY-MM-DD.md`        | 日報ドラフトファイル           |
| **参照** | `~/Obsidian/02_Daily/nippo-goals.md`             | 目標設定ファイル               |
| **出力** | `~/Obsidian/02_Daily/nippo.YYYY-MM-DD.md` (追記) | 分析結果が追記された完成日報   |

## 処理フロー

### 📋 4段階の段階的処理

1. **🔍 Phase 1: データ準備・検証**
   - ディレクトリ・ファイルの存在確認
   - ファイルサイズ・読み取り権限の検証
   - 処理前の詳細チェック

2. **🤖 Phase 2: AI分析準備**
   - 日報ドラフトの構造化読み込み
   - 目標設定ファイル（nippo-goals.md）の読み込み
   - 分析用データの正規化

3. **📄 Phase 3: AI分析・レポート生成**
   - 重点4軸での活動分析
   - 作業ログからの自動セクション生成
   - 時間サマリ生成
   - 品質チェックと出力最適化

4. **📝 Phase 4: 結果追記**
   - 分析結果を元ファイルに追記
   - 作業記録と分析の一体化
   - 次ステップの案内

## 前提条件

- `/nippo-add` で日々のタスクが記録されていること
- `/nippo-goals` で目標が設定されていること（推奨）
- Obsidianディレクトリ（`~/Obsidian/02_Daily/`）が存在すること

---

## 実行セクション

### メインスクリプト

<details>
<summary>⚙️ シェルスクリプト詳細（クリックで展開）</summary>

```bash
# =============================================================================
# 日報完成化スクリプト - 段階的処理版
# =============================================================================

!NIPPO_FILE="$HOME/Obsidian/02_Daily/nippo.$(date +%Y-%m-%d).md" && {

    # 基本変数の設定
    TIMESTAMP=$(date '+%Y%m%d_%H%M%S')
    REPORT_FILE="$HOME/Obsidian/02_Daily/nippo-report_${TIMESTAMP}.md"
    GOALS_FILE="$HOME/Obsidian/02_Daily/nippo-goals.md"

    echo "📝 日報完成化処理を開始します..."
    echo "日付: $(date '+%Y年%m月%d日 %H:%M:%S')"
    echo ""

    # ==========================================================================
    # Phase 1: データ準備・検証フェーズ
    # ==========================================================================

    echo "🔍 Phase 1: データ準備・検証"

    # ディレクトリ存在確認
    OBSIDIAN_DIR="$(dirname "$NIPPO_FILE")"
    if [ ! -d "$OBSIDIAN_DIR" ]; then
        echo "❌ Obsidianディレクトリが見つかりません: $OBSIDIAN_DIR"
        echo "ディレクトリを作成してから再実行してください。"
        exit 1
    fi
    echo "✓ ディレクトリ確認: $OBSIDIAN_DIR"

    # 日報ファイル存在・読み取り確認
    if [ ! -f "$NIPPO_FILE" ]; then
        echo "❌ 日報ファイルが見つかりません: $NIPPO_FILE"
        echo "まず /nippo-add でタスクを記録してください。"
        exit 1
    fi

    if [ ! -r "$NIPPO_FILE" ]; then
        echo "❌ 日報ファイルを読み取れません: $NIPPO_FILE"
        exit 1
    fi
    echo "✓ 日報ファイル確認: $NIPPO_FILE"

    # ファイルサイズチェック
    NIPPO_SIZE=$(wc -c < "$NIPPO_FILE" 2>/dev/null || echo "0")
    if [ "$NIPPO_SIZE" -lt 10 ]; then
        echo "❌ 日報ファイルが空または小さすぎます（${NIPPO_SIZE}バイト）"
        echo "内容を記録してから再実行してください。"
        exit 1
    fi
    echo "✓ ファイルサイズ: ${NIPPO_SIZE}バイト"

    echo "✅ Phase 1 完了: データ準備・検証"
    echo ""

    # ==========================================================================
    # Phase 2: AI分析準備フェーズ
    # ==========================================================================

    echo "🤖 Phase 2: AI分析準備"

    echo "📖 日報内容を読み込み中..."
    echo "=== 日報ファイル内容 ==="
    cat "$NIPPO_FILE"
    echo ""
    echo "======================="
    echo ""

    # 目標ファイルの読み込み
    if [ -f "$GOALS_FILE" ]; then
        echo "🎯 目標ファイルを読み込み中..."
        echo "=== 目標設定 ==="
        cat "$GOALS_FILE"
        echo ""
        echo "============="
        echo ""
    else
        echo "ℹ️  目標ファイルが見つかりません（オプション）"
        echo "より詳細な分析のため /nippo-goals で設定することを推奨します。"
        echo ""
    fi

    echo "✅ Phase 2 完了: AI分析準備"
    echo ""

    # ==========================================================================
    # Phase 3: AI分析・レポート生成フェーズ
    # ==========================================================================

    echo "📄 Phase 3: AI分析・レポート生成"
    echo "Claude Code による日報分析を実行中..."
    echo "生成されるレポート: $REPORT_FILE"
    echo ""

    # ここでClaude Codeによる分析が実行される
    # （システムプロンプトと出力フォーマットは別セクション参照）
    #
    # 【時間サマリ生成も含む - 詳細は「時間サマリ生成」セクション参照】

    echo "✅ Phase 3 完了: AI分析・レポート生成"
    echo ""

    # ==========================================================================
    # Phase 4: ファイル整理フェーズ
    # ==========================================================================

    echo "📝 Phase 4: 結果追記"
    echo "✅ Phase 4 完了: 結果追記"
    echo ""

    # ==========================================================================
    # 完了通知
    # ==========================================================================

    echo "🎉 日報完成化処理が正常に完了しました！"
    echo ""
    echo "📊 結果サマリー:"
    echo "  • 完成日報: $NIPPO_FILE (分析結果追記済み)"
    echo "  • 処理時刻: $(date '+%Y年%m月%d日 %H:%M:%S')"
    echo ""
    echo "次のステップ:"
    echo "  1. 生成されたレポートを確認"
    echo "  2. アドバイスを明日の計画に反映"
    echo "  3. 継続的な成長を意識して活動"

} || {
    echo "❌ 日報ファイルが見つかりません: $NIPPO_FILE"
    echo "まず /nippo-add でタスクを記録してください。"
    exit 1
}
```

</details>

### 補助要素

#### 目標設定表示

```bash
!GOALS_FILE="$HOME/Obsidian/02_Daily/nippo-goals.md" && if [ -f "$GOALS_FILE" ]; then echo "=== 目標設定 ==="; cat "$GOALS_FILE"; echo ""; else echo "=== 目標設定 ==="; echo "目標が設定されていません。/nippo-goals で設定してください。"; echo ""; fi
```

#### 日報ドラフト参照

@nippo_draft.txt

---

## AI分析システムプロンプト

<details>
<summary>🤖 システムプロンプト詳細（クリックで展開）</summary>

```
<system>
あなたは目標達成支援システムです。「Daily Growth Log」形式の日報と目標設定ファイル（nippo-goals.md）を分析し、重点4軸に基づいた振り返りと次のアクションを提案してください。

## 入力される日報フォーマット（Daily Growth Log）
- **今日のフォーカス（1行）**: 4軸から選んだ本日の意識ポイント
- **今日のおすすめタスク（目標逆算）**: AIが提案した目標逆算タスク
- **今日の予定**: 予定されていたタスク
- **作業ログ（分報・思考メモ）**: 時系列の思考・気づきの記録（HH:MM形式）

## 評価軸（nippo-goals.md の重点4軸）
1. **サブシステム横断のプロダクト/アーキ全体最適**: 横断視点での設計・意思決定
2. **予約サブシステムの開発推進**: 技術的な深掘り・実装の進捗
3. **ドメイン知識の横断的キャッチアップ**: 他サブシステムの理解・知識獲得
4. **組織の実行力・効力感の回復**: チーム・組織への働きかけ

## 分析の観点
- 作業ログからどの軸に関連する活動があったかを分類
- nippo-goals.md の達成基準チェックボックスに対する進捗を評価
- 作業ログから「何が変わったか」（アウトカム）を抽出
- 技術/思考/協働の観点での学び・気づきを抽出
- nippo-goals.md の日次チェックポイント5項目への回答を生成
- 達成基準との距離から翌日のアクション提案

## 出力要件
- 具体的で実行可能な次の一手
- 作業ログの事実に基づいた分析（推測を最小限に）
- 達成基準との紐づけを明示
</system>
```

</details>

### 📋 出力フォーマット仕様

<details>
<summary>📝 詳細なレポート出力フォーマット（クリックで展開）</summary>

以下のフォーマットで日報分析を作成し、日報ファイルに追記してください：

```markdown
---

## Finalize: 日報分析 - [日付]

### 🎯 今日のアウトカム

> 作業ログから「何が変わったか」を抽出

- [具体的な変化・成果1]
- [具体的な変化・成果2]

### 📊 軸別進捗サマリ

作業ログからどの軸に関連する活動があったかを分類：

| 軸 | 今日の活動 | 進捗度 |
|----|-----------|--------|
| 横断 | [関連活動の要約] | [◎/○/△/−] |
| 予約開発 | [関連活動の要約] | [◎/○/△/−] |
| ドメイン知識 | [関連活動の要約] | [◎/○/△/−] |
| 組織課題 | [関連活動の要約] | [◎/○/△/−] |

> 進捗度: ◎ 明確な前進 / ○ 意図的に取り組めた / △ 少し意識した / − 活動なし

### ✅ 達成基準チェック

> nippo-goals.md の具体的チェックボックスに対する進捗

- **横断**: [該当する達成基準] → [今日の進捗状況]
- **予約開発**: [該当する達成基準] → [今日の進捗状況]
- **ドメイン知識**: [該当する達成基準] → [今日の進捗状況]
- **組織課題**: [該当する達成基準] → [今日の進捗状況]

### 💡 学び・気づき

- **技術**: [技術的な学び]
- **思考**: [思考プロセスの気づき]
- **協働**: [チームワーク・コミュニケーションの気づき]

### 📋 日次チェックポイント

> nippo-goals.md の5項目に対応

- [ ] **横断視点**: 他サブシステムへの影響や連携は意識できたか？ → [回答]
- [ ] **予約開発**: 技術的な深掘りや進捗はあったか？ → [回答]
- [ ] **組織課題**: 課題の発見や解決に向けた動きはあったか？ → [回答]
- [ ] **Mg連携**: 他Mgとのコミュニケーションは取れたか？ → [回答]
- [ ] **スケール指向**: 設計/開発プロセスの標準化・再利用性を高める動きはあったか？ → [回答]

### 🚀 次の一手

> 達成基準との距離から翌日アクションを提案

1. **[アクション名]**
   - **Why**: [達成基準のどこに近づくか]
   - **What**: [何をするか]
   - **時間**: [目安時間]

2. **[アクション名]**
   - **Why**: [達成基準のどこに近づくか]
   - **What**: [何をするか]
   - **時間**: [目安時間]
```

</details>

---

## 時間サマリ生成

Phase 3 の一部として、作業ログから時間サマリを自動生成します。

### 処理フロー

1. **作業ログの解析**
   - `🟢 start:` と `🔴 end:` の行を抽出
   - 時刻（HH:MM形式）とタスク名をパース

2. **時間計算**
   - 同じタスク名の start/end ペアをマッチング
   - 経過時間を計算（end の経過時間があればそれを使用）
   - 同名タスクは時間を合算

3. **サマリ生成**
   日報の分析セクションの先頭に挿入:

```markdown
### ⏱ 時間サマリ

| タスク | 時間 |
|--------|------|
| PRレビュー | 1h15m |
| 実装 | 2h30m |
| MTG | 1h00m |
| **計測済み合計** | **4h45m** |
```

4. **警告表示**
   未終了タスクがあれば警告を追記:
```markdown
⚠️ 未終了: 「ドキュメント作成」(16:30開始)
```

### 時間フォーマット

- 60分未満: `45m`
- 60分以上: `1h15m`
- 時間がない場合: `--`
